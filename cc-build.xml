<project name="intellisensedebug_plugin" default="build">	
	<target name="build">
	<taskdef resource="net/sf/antcontrib/antcontrib.properties" />
	<property name="label" value="1"/>
	<property file="${basedir}\build.property" />
	<echo message="Executing the build ${label}"/>
	<echo message="Working Branch - ${target.branch}"/>
	<available file="${basedir}\branch-not-exist" property="isexist"/>
		<if>
		<equals arg1="${isexist}" arg2="true" />
		<then>
			<echo message="Sorry.. Your plugin project depends on 2 repositories. Specified branch is not existing on one of the remote repositories...."/>
			<echo />
			
			<loadfile property="errormessage"
				srcFile="branch-not-exist"/>
			<echo message="${errormessage}"/>
			<fail message="Something wrong here."/>
		</then>
		<else>
	        <tstamp/>
	        <delete file="../../../ccbuild.properties"/>
	        <delete file="../../../version.html"/>

	        <touch file="../../../ccbuild.properties"/>
	        <concat destfile="../../../ccbuild.properties" append="true" fixlastline="yes">ds=${DSTAMP}</concat>
	        <concat destfile="../../../ccbuild.properties" append="true" fixlastline="yes">ts=${TSTAMP}</concat>
	        <concat destfile="../../../ccbuild.properties" append="true" fixlastline="yes">build=${LABELNUM}</concat>
	        <concat destfile="../../../ccbuild.properties" append="true" fixlastline="yes">platform.version=1.0.0</concat>
			<!-- <concat destfile="../../../ccbuild.properties" append="true" fixlastline="yes">jar-filename-change=${jar-filename-change}</concat>
			<concat destfile="../../../ccbuild.properties" append="true" fixlastline="yes">jar-filename=${jar-filename}</concat> -->
			<concat destfile="../../../ccbuild.properties" append="true" fixlastline="yes">LABEL=${label}</concat>
			<concat destfile="../../../ccbuild.properties" append="true" fixlastline="yes">branch=${branch}</concat>

                <replace file="../../../ccbuild.properties" token="build." value=""/>

	        <touch file="../../../version.html"/>
	        <concat destfile="../../../version.html" append="true" fixlastline="yes">Build DATE = ${DSTAMP}</concat>
	        <concat destfile="../../../version.html" append="true" fixlastline="yes">Build Time = ${TSTAMP}</concat>
	        <concat destfile="../../../version.html" append="true" fixlastline="yes">Build Number =${LABELNUM}</concat>
	        <concat destfile="../../../version.html" append="true" fixlastline="yes">Build Branch =${branch}</concat>
        
		  <echo message="Compiling the Kony NativeCodegen Plugin"/>
		  <ant dir="../../../nativecodegen/com.kony.nativecodegen" antfile="plugin-compile.xml"/>
		  <echo message="Sucessfully Compiled the NativeCodegen Plugin"/>
		  
		  <echo message="Packaging the Kony NativeCodegen Plugin"/>
		  <ant dir="../../../nativecodegen/com.kony.nativecodegen" antfile="customplugin-build.xml">
			<property name="LABEL" value="${label}"/>
		  </ant>
		  <echo message="Sucessfully Packaging the Kony NativeCodegen Plugin"/>
			
		</else>
		</if>
	</target>	
</project>
